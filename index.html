<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bundle Bench — Agency Health Snapshot & Monthly Plan</title>
  <style>
    :root {
      --bg: #0f172a; --panel: #0b1222; --line: rgba(255,255,255,0.10);
      --text: #e5e7eb; --muted: #94a3b8; --accent: #6366f1;
      --good: #10b981; --warn: #f59e0b; --bad: #ef4444;
      --assumed: #64748b; --estimated: #f59e0b; --measured: #10b981;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(180deg, #0b1024, #0a0f20);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    a { color: #c7d2fe; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 20px; }
    header {
      position: sticky; top: 0;
      backdrop-filter: saturate(160%) blur(6px);
      background: rgba(15,23,42, .7);
      border-bottom: 1px solid var(--line);
      z-index: 20;
    }
    .nav {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 10px 0;
    }
    .brand {
      font-weight: 800; letter-spacing: .5px; color: #c7d2fe; text-transform: uppercase;
    }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      border: 1px solid var(--line); color: var(--text);
      padding: 10px 14px; border-radius: 12px;
      background: transparent; cursor: pointer; font-weight: 700;
    }
    .btn.primary {
      background: var(--accent); border-color: var(--accent); color: #fff;
    }
    .btn.ghost { background: transparent; }
    .hero {
      padding: 32px 0 16px; display: grid; gap: 12px;
    }
    h1 { margin: 0; font-size: 36px; line-height: 1.15; }
    .sub { color: #cbd5e1; font-size: 16px; max-width: 780px; }
    .cta { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 6px; }
    .card {
      background: rgba(255,255,255, .04);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 24px;
    }
    h2 { margin: 0 0 10px; font-size: 22px; }
    h3 {
      margin: 8px 0 8px; font-size: 16px; color: #dbeafe;
      letter-spacing: .3px; text-transform: uppercase;
    }
    .dils, .dials { } /* kept for compatibility */
    .dials {
      display: grid; grid-template-columns: repeat(12,1fr); gap: 12px;
    }
    .dial {
      grid-column: span 4;
      background: rgba(255,255,255, .03);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      display: flex; flex-direction: column; gap: 6px;
    }
    .dial .label { color: #cbd5e1; font-size: 12px; }
    .dial .value { font-size: 22px; font-weight: 800; }
    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      font-size: 11px; border-radius: 999px;
      border: 1px solid var(--line); padding: 3px 8px;
      color: var(--text);
    }
    .badge.assumed {
      border-color: #475569; color: #e2e8f0;
    }
    .badge.estimated {
      border-color: #f59e0b; color: #fde68a;
    }
    .badge.measured {
      border-color: #10b981; color: #a7f3d0;
    }
    .scenario {
      display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;
    }
    .scenario .option {
      padding: 8px 10px; border: 1px solid var(--line);
      border-radius: 999px; cursor: pointer;
    }
    .scenario .option.active {
      background: rgba(99,102,241, .18); border-color: var(--accent);
    }
    .plan-list {
      list-style: none; margin: 0; padding: 0;
      display: grid; grid-template-columns: repeat(12,1fr); gap: 12px;
    }
    .plan-item {
      grid-column: span 6;
      background: rgba(255,255,255, .03);
      border: 1px solid var(--line);
      border-radius: 12px; padding: 12px;
    }
    .muted { color: var(--muted); }
    .two-col {
      display: grid; grid-template-columns: repeat(12,1fr); gap: 16px;
    }
    .two-col > .left { grid-column: span 7; }
    .two-col > .right { grid-column: span 5; }
    label {
      display: block; font-size: 12px; color: #cbd5e1;
      margin: 8px 0 6px;
    }
    input[type="number"], select {
      width: 100%; padding: 10px 12px;
      background: #0b1222; border: 1px solid #22304a;
      color: var(--text); border-radius: 10px;
    }
    .row {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    .legend {
      display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px;
    }
    .legend .item {
      display: flex; align-items: center; gap: 6px;
      font-size: 12px; color: #cbd5e1;
    }
    .error { color: #f76c6c; margin-top: 12px; }
    @media (max-width: 860px) {
      h1 { font-size: 28px; }
      .two-col { grid-template-columns: 1fr; }
      .two-col > .left, .two-col > .right { grid-column: span 12; }
      .dial { grid-column: span 6; }
      .plan-item { grid-column: span 12; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">Bundle Bench</div>
      <div>
        <a class="btn ghost" href="#snapshot">See my health snapshot</a>
        <a class="btn primary" href="#plan">View this month’s plan</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="hero">
      <h1>Understand your agency’s health at a glance.</h1>
      <p class="sub">A calm monthly readout of capacity, remarketing pressure, and where to focus — plus a short plan your team will actually follow.</p>
      <div class="cta">
        <a class="btn primary" href="#snapshot">See my health snapshot</a>
        <a class="btn ghost" href="#plan">View this month’s plan</a>
        <a class="btn ghost" href="#concierge">Try concierge pilot</a>
      </div>
    </section>

    <section class="card">
      <h2>Upload Your Data</h2>
      <div>
        <label for="csv-household">Household Snapshot CSV:</label>
        <input type="file" id="csv-household" accept=".csv" />
      </div>
      <div style="margin-top:12px;">
        <label for="csv-event">Event Log CSV (optional):</label>
        <input type="file" id="csv-event" accept=".csv" />
      </div>
      <div class="error" id="upload-error"></div>
    </section>

    <section id="snapshot" class="card" style="display:none;">
      <div class="two-col">
        <div class="left">
          <h2>Health Snapshot</h2>
          <div class="dials">
            <div class="dial" id="dial-tbn">
              <div class="label">Time-Back Number™</div>
              <div class="value" id="val-tbn">—</div>
              <div class="badge assumed" id="conf-tbn">Assumed</div>
            </div>
            <div class="dial" id="dial-bscore">
              <div class="label">BenchScore™</div>
              <div class="value" id="val-bscore">—</div>
              <div class="badge assumed" id="conf-bscore">Assumed</div>
            </div>
            <div class="dial" id="dial-rl">
              <div class="label">Remarketing Load</div>
              <div class="value" id="val-rl">—</div>
              <div class="badge assumed" id="conf-rl">Assumed</div>
            </div>
            <div class="dial" id="dial-sti">
              <div class="label">Service Touch Index</div>
              <div class="value" id="val-sti">—</div>
              <div a class="badge assumed" id="conf-sti">Assumed</div>
            </div>
            <div class="dial" id="dial-depth">
              <div class="label">Coverage Depth</div>
              <div class="value" id="val-depth">—</div>
              <div class="badge assumed" id="conf-depth">Assumed</div>
            </div>
            <div class="dial" id="dial-tenure">
              <div class="label">Tenure Momentum</div>
              <div class="value" id="val-tenure">—</div>
              <div class="badge assumed" id="conf-tenure">Assumed</div>
            </div>
          </div>
          <div class="legend" style="margin-top:12px;">
            <div class="item"><span class="badge assumed">Assumed</span> defaults</div>
            <div class="item"><span class="badge estimated">Estimated</span> from quiz or partial data</div>
            <div class="item"><span class="badge measured">Measured</span> from full data</div>
          </div>
          <div class="scenario" style="margin-top:12px;">
            <div class="option active" data-scenario="baseline">Baseline</div>
            <div class="option" data-scenario="hard">Hard Market</div>
            <div class="option" data-scenario="renewal">Busy Renewal</div>
            <div class="option" data-scenario="growth">Growth Push</div>
          </div>
        </div>
        <div class="right">
          <h3>Personalize (optional)</h3>
          <div class="muted" style="margin-bottom:8px;">
            Improves accuracy from <span class="badge estimated">Estimated</span> to better.
          </div>
          <div class="row">
            <div>
              <label>Households in scope</label>
              <input type="number" id="q-book" value="500" min="10" step="10">
            </div>
            <div>
              <label>CSR cost, $/hr</label>
              <input type="number" id="q-csr" value="32" min="10" step="1">
            </div>
          </div>
          <div class="row" style="margin-top:8px;">
            <div>
              <label>Bundling rate</label>
              <select id="q-br">
                <option value="0.35">35%</option>
                <option value="0.45" selected>45%</option>
                <option value="0.55">55%</option>
                <option value="0.65">65%</option>
              </select>
            </div>
            <div>
              <label>Remarkets per 100 renewals</label>
              <input type="number" id="q-rl" value="19" min="0" step="1">
            </div>
          </div>
          <div class="row" style="margin-top:8px;">
            <div>
              <label>Minutes per service touch</label>
              <input type="number" id="q-aht" value="5" min="1" step="1">
            </div>
            <div>
              <label>Minutes per remarket</label>
              <input type="number" id="q-rm" value="80" min="10" step="5">
            </div>
          </div>
          <div class="row" style="margin-top:8px;">
            <div>
              <label>Claims follow-up style</label>
              <select id="q-claims">
                <option value="reactive">Reactive</option>
                <option value="balanced" selected>Balanced</option>
                <option value="proactive">Proactive</option>
              </select>
            </div>
            <div>
              <label>Top‑N (targets)</label>
              <select id="q-topn">
                <option>5</option>
                <option selected>10</option>
                <option>15</option>
              </select>
            </div>
          </div>
          <div class="cta" style="margin-top:12px;">
            <button class="btn primary" id="btn-apply">Apply</button>
            <button class="btn ghost" id="btn-reset">Reset</button>
          </div>
        </div>
      </div>
    </section>

    <section id="plan" class="card" style="display:none; margin-top:24px;">
      <h2>This Month’s Plan</h2>
      <div class="band" style="margin-bottom:10px;">
        <strong id="plan-headline">Top‑N outreach ready</strong>
        <div class="muted">Follow these items to capture your Time-Back Number.</div>
      </div>
      <ul class="plan-list" id="top-list">
        <!-- dynamic plan items go here -->
      </ul>
    </section>

    <section id="concierge" class="card" style="margin-top:24px;">
      <h2>Concierge pilot</h2>
      <p>Send a basic CSV and we’ll return Top‑100, kits, before/after snapshot.</p>
      <p><a href="bundlelift_csv_template.csv" download>CSV Import Template</a></p>
    </section>

    <section id="learn" class="card" style="margin-top:24px;">
      <h2>Learn about metrics</h2>
      <div class="accordion">
        <details class="ac" id="m-tbn"><summary>Time‑Back Number™</summary><div class="ac-body"><p>The hours you can recapture this month by executing your plan.</p></div></details>
        <details class="ac" id="m-bscore"><summary>BenchScore™</summary><div class="ac-body"><p>A 0–100 composite of your health across metrics.</p></div></details>
        <details class="ac" id="m-rl"><summary>Remarketing Load</summary><div class="ac-body"><p>Remarkets per 100 renewals — your “fire-drill meter.”</p></div></details>
        <details class="ac" id="m-sti"><summary>Service Touch Index</summary><div class="ac-body"><p>Average touches × minutes per household — measure of operational drag.</p></div></details>
        <details class="ac" id="m-depth"><summary>Coverage Depth</summary><div class="ac-body"><p>% of households with ≥ 2 lines (or bundling/umbrella).</p></div></details>
        <details class="ac" id="m-tenure"><summary>Tenure Momentum</summary><div class="ac-body"><p>Rate of change in average years on book.</p></div></details>
      </div>
    </section>

    <section id="faq" class="card" style="margin-top:24px;">
      <h2>FAQ</h2>
      <details open><summary>Do you store PII?</summary><p>No. Use IDs only; names/emails are optional and not required.</p></details>
      <details><summary>How accurate are the numbers?</summary><p>Initially based on assumptions (“Assumed”), improved with quiz data (“Estimated”), best with full CSV (“Measured”).</p></details>
      <details><summary>Does this replace my core AMS?</summary><p>No. This works beside it — turning your data into insights + plans.</p></details>
    </section>

    <footer style="margin-top:30px; text-align:center; font-size:12px; color: var(--muted);">
      © Bundle Bench. For planning only. <a href="#hero">Back to top</a>
    </footer>
  </main>

  <script>
  (function(){
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // CSV parsing helper (supports quoted fields)
    function parseCSV(text) {
      const lines = text.split(/\r?\n/).filter(l => l.trim().length);
      if (!lines.length) return [];
      const headerParts = lines[0].match(/(".*?"|[^",\\s]+)(?=,|$)/g) || [];
      const headers = headerParts.map(h => h.replace(/^"|"$/g, ""));
      const rows = [];
      for (let i = 1; i < lines.length; i++) {
        const parts = lines[i].match(/(".*?"|[^",\\s]+)(?=,|$)/g) || [];
        const obj = {};
        headers.forEach((h, idx) => {
          let v = parts[idx] || "";
          v = v.replace(/^"|"$/g, "");
          obj[h.trim()] = v.trim();
        });
        rows.push(obj);
      }
      return rows;
    }

    function validateHousehold(rows) {
      if (!rows.length) return false;
      const req = ["household_id", "lines_count", "remarkets_12m", "service_touches_12m"];
      return req.every(k => k in rows[0]);
    }
    function validateEvents(rows) {
      if (!rows.length) return true;
      const req = ["household_id", "event_type", "minutes_spent"];
      return req.every(k => k in rows[0]);
    }

    function showError(msg) {
      $('#upload-error').textContent = msg;
    }

    let householdData = [];
    let eventData = [];

    function handleHouseholdFile(file) {
      const reader = new FileReader();
      reader.onload = e => {
        const text = e.target.result;
        const rows = parseCSV(text);
        if (!validateHousehold(rows)) {
          showError("Household CSV missing required columns.");
          return;
        }
        householdData = rows;
        showError("");
        tryComputeAndRender();
      };
      reader.readAsText(file);
    }
    function handleEventFile(file) {
      const reader = new FileReader();
      reader.onload = e => {
        const text = e.target.result;
        const rows = parseCSV(text);
        if (!validateEvents(rows)) {
          showError("Event CSV missing required columns.");
          return;
        }
        eventData = rows;
        showError("");
        tryComputeAndRender();
      };
      reader.readAsText(file);
    }

    $('#csv-household').addEventListener('change', e => {
      if (e.target.files[0]) handleHouseholdFile(e.target.files[0]);
    });
    $('#csv-event').addEventListener('change', e => {
      if (e.target.files[0]) handleEventFile(e.target.files[0]);
    });

    function computeMetrics() {
      const hh = householdData;
      const ev = eventData;
      if (!hh.length) return null;

      const count = hh.length;
      const totalLines = hh.reduce((s, h) => s + (parseInt(h.lines_count) || 0), 0);
      const depth = totalLines / (count * 2);

      const totalRemarks = ev.filter(e => e.event_type === "remarket").length;
      const rl = (totalRemarks / count) * 100;

      const totalTouchMin = ev.filter(e => e.event_type === "service_touch")
        .reduce((s, e) => s + (parseFloat(e.minutes_spent) || 0), 0);
      const sti = totalTouchMin / count;

      const avgTen = hh.reduce((s, h) => s + (parseFloat(h.tenure_years) || 0), 0) / count;

      const bundledCount = hh.filter(h => (h.bundled_flag === "1" || h.bundled_flag === "true")).length;
      const brRate = bundledCount / count || 0;

      const bench = Math.round((brRate * 0.5 + (1 - rl/100) * 0.3 + (1 - sti/10) * 0.2) * 100);

      const tbn = rl * 0.5;  // dummy formula

      return { depth, rl, sti, avgTen, bench, tbn };
    }

    function tryComputeAndRender() {
      const m = computeMetrics();
      if (!m) return;
      $('#snapshot').style.display = "block";
      $('#plan').style.display = "block";

      $('#val-depth').textContent = `${(m.depth * 100).toFixed(1)}%`;
      $('#val-rl').textContent = `${m.rl.toFixed(1)} per 100`;
      $('#val-sti').textContent = `${m.sti.toFixed(1)} mins/HH`;
      $('#val-bscore').textContent = `${m.bench} / 100`;
      $('#val-tenure').textContent = `${m.avgTen.toFixed(1)} yrs`;
      $('#val-tbn').textContent = `${m.tbn.toFixed(1)} hrs`;

      const topList = $('#top-list');
      topList.innerHTML = "";
      const topN = Math.min(5, householdData.length);
      for (let i = 0; i < topN; i++) {
        const h = householdData[i];
        const li = document.createElement("li");
        li.className = "plan-item";
        li.textContent = `#${i+1} — HH ${h.household_id}: review coverage`;
        topList.appendChild(li);
      }
    }

  })();
  </script>
</body>
</html>
