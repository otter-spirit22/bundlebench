<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bundle Bench — Agency Health Snapshot &amp; Monthly Plan</title>
  <style>
    :root {
      --bg: #0f172a; --panel: #0b1222; --line: rgba(255,255,255,0.10);
      --text: #e5e7eb; --muted: #94a3b8; --accent: #6366f1;
      --good: #10b981; --warn: #f59e0b; --bad: #ef4444;
      --assumed: #64748b; --estimated: #f59e0b; --measured: #10b981;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(180deg, #0b1024, #0a0f20);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    a {
      color: #c7d2fe;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .wrap {
      max-width: 1080px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      position: sticky;
      top: 0;
      backdrop-filter: saturate(160%) blur(6px);
      background: rgba(15,23,42, .7);
      border-bottom: 1px solid var(--line);
      z-index: 20;
    }
    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 0;
    }
    .brand {
      font-weight: 800;
      letter-spacing: .5px;
      color: #c7d2fe;
      text-transform: uppercase;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--line);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      background: transparent;
      cursor: pointer;
      font-weight: 700;
    }
    .btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .btn.ghost {
      background: transparent;
    }
    .hero {
      padding: 32px 0 16px;
      display: grid;
      gap: 12px;
    }
    h1 {
      margin: 0;
      font-size: 36px;
      line-height: 1.15;
    }
    .sub {
      color: #cbd5e1;
      font-size: 16px;
      max-width: 780px;
    }
    .cta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
    }
    .card {
      background: rgba(255,255,255, .04);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
    }
    h2 {
      margin: 0 0 10px;
      font-size: 22px;
    }
    h3 {
      margin: 8px 0 8px;
      font-size: 16px;
      color: #dbeafe;
      letter-spacing: .3px;
      text-transform: uppercase;
    }
    .dials {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .dial {
      grid-column: span 4;
      background: rgba(255,255,255, .03);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .dial .label {
      color: #cbd5e1;
      font-size: 12px;
    }
    .dial .value {
      font-size: 22px;
      font-weight: 800;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--line);
      padding: 3px 8px;
      color: var(--text);
    }
    .badge.assumed {
      border-color: #475569;
      color: #e2e8f0;
    }
    .badge.estimated {
      border-color: #f59e0b;
      color: #fde68a;
    }
    .badge.measured {
      border-color: #10b981;
      color: #a7f3d0;
    }
    .scenario {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .scenario .option {
      padding: 8px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
      cursor: pointer;
    }
    .scenario .option.active {
      background: rgba(99,102,241, .18);
      border-color: var(--accent);
    }
    .plan-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .plan-item {
      grid-column: span 6;
      background: rgba(255,255,255, .03);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
    }
    .muted {
      color: var(--muted);
    }
    .two-col {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
    }
    .two-col > .left {
      grid-column: span 7;
    }
    .two-col > .right {
      grid-column: span 5;
    }
    label {
      display: block;
      font-size: 12px;
      color: #cbd5e1;
      margin: 8px 0 6px;
    }
    input[type="number"], select {
      width: 100%;
      padding: 10px 12px;
      background: #0b1222;
      border: 1px solid #22304a;
      color: #e5e7eb;
      border-radius: 10px;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .legend {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .legend .item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #cbd5e1;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .table th, .table td {
      padding: 10px;
      border-bottom: 1px solid var(--line);
      text-align: left;
    }
    .band {
      background: rgba(99,102,241, .12);
      border: 1px solid var(--accent);
      padding: 16px;
      border-radius: 12px;
    }
    footer {
      margin: 30px 0 18px;
      color: #94a3b8;
      font-size: 12px;
      text-align: center;
    }
    @media (max-width: 860px) {
      h1 { font-size: 28px; }
      .two-col {
        grid-template-columns: 1fr;
      }
      .two-col > .left, .two-col > .right {
        grid-column: span 12;
      }
      .dial {
        grid-column: span 6;
      }
      .plan-item {
        grid-column: span 12;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">Bundle Bench</div>
      <div>
        <a class="btn ghost" href="#snapshot">See my health snapshot</a>
        <a class="btn primary" href="#plan">View this month’s plan</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="hero">
      <h1>Understand your agency’s health at a glance.</h1>
      <p class="sub">A calm monthly readout of capacity, remarketing pressure, and where to focus—plus a short plan your team will actually follow. No data upload required.</p>
      <div class="cta">
        <a class="btn primary" href="#snapshot">See my health snapshot</a>
        <a class="btn ghost" href="#plan">View this month’s plan</a>
        <a class="btn ghost" href="#concierge">Try a concierge pilot</a>
      </div>
    </section>

    <section id="snapshot" class="card">
      <div class="two-col">
        <div class="left">
          <h2>Health Snapshot</h2>
          <div class="dials">
            <div class="dial" id="dial-tbn">
              <div class="label">Time-Back Number™</div>
              <div class="value" id="val-tbn">—</div>
              <div class="badge assumed" id="conf-tbn">Assumed</div>
            </div>
            <div class="dial" id="dial-bscore">
              <div class="label">BenchScore™</div>
              <div class="value" id="val-bscore">—</div>
              <div class="badge assumed" id="conf-bscore">Assumed</div>
            </div>
            <div class="dial" id="dial-rl">
              <div class="label">Remarketing Load</div>
              <div class="value" id="val-rl">—</div>
              <div class="badge assumed" id="conf-rl">Assumed</div>
            </div>
            <div class="dial" id="dial-sti">
              <div class="label">Service Touch Index</div>
              <div class="value" id="val-sti">—</div>
              <div class="badge assumed" id="conf-sti">Assumed</div>
            </div>
            <div class="dial" id="dial-depth">
              <div class="label">Coverage Depth</div>
              <div class="value" id="val-depth">—</div>
              <div class="badge assumed" id="conf-depth">Assumed</div>
            </div>
            <div class="dial" id="dial-tenure">
              <div class="label">Tenure Momentum</div>
              <div class="value" id="val-tenure">—</div>
              <div class="badge assumed" id="conf-tenure">Assumed</div>
            </div>
          </div>

          <div class="legend">
            <div class="item">
              <span class="badge assumed">Assumed</span> sensible defaults
            </div>
            <div class="item">
              <span class="badge estimated">Estimated</span> derived from your quick answers
            </div>
            <div class="item">
              <span class="badge measured">Measured</span> captured automatically
            </div>
          </div>

          <div class="scenario">
            <div class="option active" data-scenario="baseline">Baseline</div>
            <div class="option" data-scenario="hard">Hard Market</div>
            <div class="option" data-scenario="renewal">Busy Renewal Month</div>
            <div class="option" data-scenario="growth">Growth Push</div>
          </div>

        </div>
        <div class="right">
          <h3>Personalize (60 seconds)</h3>
          <div class="muted" style="margin-bottom:8px">
            Optional. No uploads. Improves accuracy to <span class="badge estimated">Estimated</span>.
          </div>
          <div class="row">
            <div>
              <label>Households in scope</label>
              <input type="number" id="q-book" value="500" min="50" step="50">
            </div>
            <div>
              <label>CSR loaded cost ($/hr)</label>
              <input type="number" id="q-csr" value="32" min="20" step="1">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Bundling rate (rough)</label>
              <select id="q-br">
                <option value="0.35">35%</option>
                <option value="0.45" selected>45%</option>
                <option value="0.55">55%</option>
                <option value="0.65">65%</option>
              </select>
            </div>
            <div>
              <label>Remarkets per 100 renewals</label>
              <input type="number" id="q-rl" value="19" min="0" step="1">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Typical minutes per touch</label>
              <input type="number" id="q-aht" value="5" min="1" step="1">
            </div>
            <div>
              <label>Minutes per remarket (est.)</label>
              <input type="number" id="q-rm" value="80" min="30" step="5">
            </div>
          </div>
          <div class="row">
            <div>
              <label>Claims follow-up style</label>
              <select id="q-claims">
                <option value="reactive">Mostly reactive</option>
                <option value="balanced" selected>Balanced</option>
                <option value="proactive">Proactive updates</option>
              </select>
            </div>
            <div>
              <label>Top-10 plan size (targets)</label>
              <select id="q-topn">
                <option>10</option>
                <option selected>12</option>
                <option>15</option>
              </select>
            </div>
          </div>

          <div class="cta" style="margin-top:12px">
            <button class="btn primary" id="btn-apply">Apply to snapshot</button>
            <button class="btn ghost" id="btn-reset">Reset</button>
          </div>
        </div>
      </div>
    </section>

    <section id="plan" class="card">
      <h2>This Month’s Plan</h2>
      <div class="band" style="margin-bottom:10px">
        <strong id="plan-headline">Top‑12 outreach ready</strong>
        <div class="muted">Follow these outreach items to capture your Time-Back Number. Each has one-line reason and ready PDF.</div>
      </div>

      <ul class="plan-list" id="top-list">
        <!-- plan items will be injected by JS -->
      </ul>

      <div class="two-col" style="margin-top:12px">
        <div class="left">
          <h3>Stop the fire drills</h3>
          <p><strong>No-Reflex Remarket™:</strong> Only quote when coverage fit or price delta clears your threshold; otherwise round the account first.</p>
          <p><strong>30-Day Pre-Renewal Touch:</strong> Proactive check-in with expectations + options; reduces last-minute saves.</p>
        </div>
        <div class="right">
          <h3>Ready-to-use PDFs</h3>
          <p><a href="Meeting_Kit_Template.pptx" download>Client Meeting Kit (one-pager)</a></p>
          <p><a href="Monthly_Scorecard_Template.pptx" download>Monthly Scorecard (owner view)</a></p>
          <p class="muted">Use these while we tailor your plan. No logins; export to PDF for your team.</p>
        </div>
      </div>
    </section>

    <section id="concierge" class="card">
      <h2>Concierge pilot</h2>
      <p>Send a basic export (or use our CSV template). We’ll return your <strong>Top-100 list</strong>, <strong>Meeting Kits</strong>, and a <strong>before/after snapshot</strong>.</p>
      <p><a href="bundlelift_csv_template.csv" download>CSV Import Template</a></p>
      <div class="band">Prefer no uploads? We can work from counts (book size, renewals/month, remarkets) and still deliver a credible plan.</div>
    </section>

    <section id="learn" class="card">
      <h2>Learn more about the measurements</h2>
      <div class="accordion">
        <details class="ac" id="m-tbn">
          <summary>Time-Back Number™ — what it is and why it matters</summary>
          <div class="ac-body"><p>The hours you can reclaim this month by completing the plan. It transforms friction (remarkets, service touches) into schedule space.</p></div>
        </details>
        <details class="ac" id="m-bscore">
          <summary>BenchScore™ — the monthly health score</summary>
          <div class="ac-body"><p>A 0–100 composite of five dials: Bundling Rate, Remarketing Load, Service Touch Index, Retention Strength, Experience Quality.</p></div>
        </details>
        <details class="ac" id="m-rl">
          <summary>Remarketing Load — the fire-drill meter</summary>
          <div class="ac-body"><p>Remarkets per 100 renewals. A high RL means more reactive quoting vs proactive work.</p></div>
        </details>
        <details class="ac" id="m-sti">
          <summary>Service Touch Index — the back-and-forth meter</summary>
          <div class="ac-body"><p>Touches × minutes per household. It quantifies the operational drag and chance for error.</p></div>
        </details>
        <details class="ac" id="m-depth">
          <summary>Coverage Depth — lines per household</summary>
          <div class="ac-body"><p>% of households with ≥2 lines (auto+home); umbrella adds stability & upsell potential.</p></div>
        </details>
        <details class="ac" id="m-tenure">
          <summary>Tenure Momentum — years on book trending</summary>
          <div class="ac-body"><p>Tracks direction and speed of average years on book. Often moves with coverage depth and client satisfaction.</p></div>
        </details>
      </div>
    </section>

    <!-- Add this block to your index.html, e.g. after the "Concierge pilot" section -->

<section id="csv-uploader" class="card" style="margin-top:24px;">
  <h2>CSV Uploader: Visualize Agency Metrics</h2>
  <div id="csv-dropzone" class="dropzone" style="padding:24px; border:2px dashed var(--accent); border-radius:12px; text-align:center;">
    <p><strong>Drag &amp; drop your CSV here</strong><br>or <input type="file" id="csv-file" accept=".csv"></p>
    <div id="csv-progress" style="display:none; margin:12px;">Parsing...</div>
  </div>
  <div id="csv-mapping" style="display:none; margin-top:18px;"></div>
  <div id="csv-metrics" style="display:none; margin-top:18px;">
    <h3>Computed Metrics</h3>
    <canvas id="dial-coverageDepth" width="180" height="180"></canvas>
    <canvas id="dial-remarketingLoad" width="180" height="180"></canvas>
    <canvas id="dial-serviceTouchIndex" width="180" height="180"></canvas>
    <canvas id="dial-tenureMomentum" width="180" height="180"></canvas>
    <canvas id="dial-timeBackNumber" width="180" height="180"></canvas>
    <canvas id="dial-benchScore" width="180" height="180"></canvas>
  </div>
</section>

<!-- PapaParse CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const requiredColumns = [
  {key: 'household_id', label: 'Household ID'},
  {key: 'lines_count', label: 'Lines Count'},
  {key: 'bundled_flag', label: 'Bundled?'},
  {key: 'umbrella_flag', label: 'Umbrella?'},
  {key: 'tenure_years', label: 'Tenure (years)'},
  {key: 'service_touches_12m', label: 'Service Touches (12m)'},
  {key: 'avg_minutes_per_touch', label: 'Avg Minutes/Touch'},
  {key: 'remarkets_12m', label: 'Remarkets (12m)'},
  {key: 'retained_last_term_flag', label: 'Retained Last Term?'},
  {key: 'churn_risk_score_0_1', label: 'Churn Risk Score (0-1)'}
  // Add more as needed for advanced metrics
];

let csvRows = [];
let columnMapping = {};

function showMappingUI(headers, previewRows) {
  const mappingDiv = document.getElementById('csv-mapping');
  mappingDiv.innerHTML = `<h3>Map CSV Columns</h3>
    <table style="margin-bottom:12px;">
      <tr>
        <th>Metric</th>
        <th>Your CSV Column</th>
      </tr>
      ${requiredColumns.map(col => `
        <tr>
          <td>${col.label}</td>
          <td>
            <select id="map-${col.key}">
              <option value="">-- Select --</option>
              ${headers.map(h => `<option value="${h}" ${h.toLowerCase().includes(col.key) ? 'selected' : ''}>${h}</option>`).join('')}
            </select>
          </td>
        </tr>
      `).join('')}
    </table>
    <button class="btn primary" id="csv-map-confirm">Confirm Mapping</button>
    <h4>CSV Preview</h4>
    <pre style="font-size:11px; background:#0001; border-radius:8px; padding:8px;">${JSON.stringify(previewRows,null,2)}</pre>
  `;
  mappingDiv.style.display = '';
  document.getElementById('csv-map-confirm').onclick = function() {
    // Save mapping
    requiredColumns.forEach(col => {
      columnMapping[col.key] = document.getElementById('map-' + col.key).value;
    });
    mappingDiv.style.display = 'none';
    computeAndShowMetrics();
  };
}

function computeAndShowMetrics() {
  // Extract mapped columns
  function get(row, key) {
    let mapped = columnMapping[key];
    if (!mapped) return undefined;
    let val = row[mapped];
    if (typeof val === 'string') val = val.trim();
    // Convert flags to 0/1 if possible
    if (mapped.toLowerCase().includes('flag')) {
      if (val === '1' || val === 'true' || val === 'yes') return 1;
      if (val === '0' || val === 'false' || val === 'no') return 0;
    }
    // Convert numbers
    if (!isNaN(val)) return Number(val);
    return val;
  }

  // Metrics
  const households = csvRows.filter(row => get(row,'household_id'));
  const lines2 = households.filter(row => get(row,'lines_count') >= 2 || get(row,'bundled_flag') == 1 || get(row,'umbrella_flag') == 1).length;
  const coverageDepth = households.length ? lines2 / households.length : 0;

  const remarkets = households.map(row => get(row,'remarkets_12m') || 0).reduce((a,b)=>a+b,0);
  const renewals = households.length; // Assuming each row is a renewal
  const remarketingLoad = renewals ? (remarkets / renewals) * 100 : 0;

  const serviceTouches = households.map(row => get(row,'service_touches_12m') || 0).reduce((a,b)=>a+b,0);
  const avgMinTouch = households.map(row => get(row,'avg_minutes_per_touch') || 0).reduce((a,b)=>a+b,0) / (households.length || 1);
  const serviceTouchIndex = serviceTouches * avgMinTouch / (households.length || 1);

  const tenureAvg = households.map(row => get(row,'tenure_years') || 0).reduce((a,b)=>a+b,0) / (households.length || 1);
  // Direction is tracked MoM; here, just average
  const tenureMomentum = tenureAvg;

  // Time-Back Number™: For simplicity, delta between unbundled and bundled (here, just a mock calculation)
  // You can refine with more columns (split signals, event log, etc.)
  const timeBackNumber = ((remarketingLoad * avgMinTouch) / 60) * 12; // Monthly hours for top-12

  // BenchScore™: weighted blend as per your formula
  const br = coverageDepth; // Bundling Rate proxy
  const rl = 1 - (remarketingLoad / 100); // Inverse load
  const sti = 1 - (serviceTouchIndex / 10); // Scaled
  const tenure = tenureMomentum / 10; // Scaled
  const eq = 1 - (households.map(row => get(row,'churn_risk_score_0_1') || 0).reduce((a,b)=>a+b,0) / (households.length || 1)); // Experience Quality

  const benchScore = Math.round((br * 0.25 + rl * 0.20 + sti * 0.15 + tenure * 0.20 + eq * 0.20) * 100);

  // Show metrics visually
  document.getElementById('csv-metrics').style.display = '';
  drawDial('dial-coverageDepth','Coverage Depth',coverageDepth,1);
  drawDial('dial-remarketingLoad','Remarketing Load',remarketingLoad,100);
  drawDial('dial-serviceTouchIndex','Service Touch Index',serviceTouchIndex,10);
  drawDial('dial-tenureMomentum','Tenure Momentum',tenureMomentum,10);
  drawDial('dial-timeBackNumber','Time-Back Number™',timeBackNumber,100); // Adjust max as needed
  drawDial('dial-benchScore','BenchScore™',benchScore,100);
}

function drawDial(canvasId,label,value,max) {
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (window[canvasId + 'Chart']) window[canvasId + 'Chart'].destroy();
  window[canvasId + 'Chart'] = new Chart(ctx,{
    type: 'doughnut',
    data: {
      labels: [label],
      datasets: [{
        data: [value, Math.max(0,max-value)],
        backgroundColor: ['#6366f1','#94a3b8'],
        borderWidth: 2
      }]
    },
    options: {
      plugins: {
        legend: {display:false},
        tooltip: {enabled:true},
        title: {display:true, text: label}
      },
      cutout: '70%',
    }
  });
}

document.getElementById('csv-file').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  document.getElementById('csv-progress').style.display = 'block';
  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      document.getElementById('csv-progress').style.display = 'none';
      csvRows = results.data;
      showMappingUI(results.meta.fields, results.data.slice(0,5));
    }
  });
});

// Optional: drag-and-drop support
const dropzone = document.getElementById('csv-dropzone');
dropzone.addEventListener('dragover', function(e){
  e.preventDefault(); dropzone.style.background='#6366f122';
});
dropzone.addEventListener('dragleave', function(e){
  e.preventDefault(); dropzone.style.background='';
});
dropzone.addEventListener('drop', function(e){
  e.preventDefault(); dropzone.style.background='';
  if (e.dataTransfer.files.length) {
    document.getElementById('csv-file').files = e.dataTransfer.files;
    document.getElementById('csv-file').dispatchEvent(new Event('change'));
  }
});
</script>

    <section id="faq" class="card">
      <h2>FAQ</h2>
      <details open><summary>Do you store PII?</summary><p>No. You can remove names and use household IDs only. Optional email parsing stores only event type and ID.</p></details>
      <details><summary>How accurate are the numbers?</summary><p>Strong on launch (Assumed). More accurate with quiz (Estimated). Best with optional signals (Measured).</p></details>
      <details><summary>Does this replace my AMS?</summary><p>No. Bundle Bench sits beside your AMS, turning data into monthly insight and action.</p></details>
    </section>

    <footer>
      © Bundle Bench. For planning only; actual times vary by workflow. • <a href="#hero">Back to top</a>
    </footer>

  </main>

  <script>
  (function(){
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
    const fmtHours = h => `${h.toLocaleString(undefined,{maximumFractionDigits:0})} hrs`;
    const pct = n => `${(n * 100).toFixed(0)}%`;

    const state = {
      scenario: 'baseline',
      inputs: { book:500, csr:32, br:0.45, rl:19, aht:5, rm:80, claims:'balanced', topn:12 }
    };

    const presets = {
      baseline: { br:0.45, rl:19, aht:5, rm:80, depth:0.41, tenure:5.8, topn:12 },
      hard:     { br:0.42, rl:24, aht:6, rm:90, depth:0.38, tenure:5.5, topn:12 },
      renewal:  { br:0.45, rl:22, aht:6, rm:85, depth:0.41, tenure:5.7, topn:15 },
      growth:   { br:0.50, rl:18, aht:5, rm:75, depth:0.48, tenure:6.2, topn:12 }
    };

    function computeSnapshot(){
      const p = presets[state.scenario];
      const br = state.inputs.br ?? p.br;
      const rl = state.inputs.rl ?? p.rl;
      const aht = state.inputs.aht ?? p.aht;
      const rm = state.inputs.rm ?? p.rm;
      const depth = p.depth * (br / p.br);
      const tenure = p.tenure + (br - p.br) * 2;
      const topn = parseInt(state.inputs.topn,10) || p.topn;

      const minutesPerTarget = (rm * 0.4) + (aht * 3);
      const tbnHours = (minutesPerTarget * topn) / 60;

      const sti = 2.2 + (rl / 100) + (br < 0.5 ? 0.4 : 0.2);

      const wBR = clamp((br - 0.35) / 0.35, 0, 1);
      const wRL = clamp(1 - (rl / 35), 0, 1);
      const wSTI = clamp(1 - ((sti - 2.0) / 2.0), 0, 1);
      const wTEN = clamp((tenure - 5.0) / 2.5, 0, 1);
      const wEQ = state.inputs.claims === 'proactive' ? 0.9 : state.inputs.claims === 'balanced' ? 0.7 : 0.5;

      const benchScore = Math.round(
        (wBR * 0.25 + wRL * 0.20 + wSTI * 0.15 + wTEN * 0.20 + wEQ * 0.20) * 100
      );

      $('#val-tbn').textContent = fmtHours(tbnHours);
      $('#val-bscore').textContent = `${benchScore} / 100`;
      $('#val-rl').textContent = `${rl} / 100 renewals`;
      $('#val-sti').textContent = `${sti.toFixed(1)} touches / HH`;
      $('#val-depth').textContent = `${pct(depth)} ≥2 lines`;
      $('#val-tenure').textContent = `${tenure.toFixed(1)} yrs`;

      $('#plan-headline').textContent = `Top‑${topn} outreach ready`;
      const reasons = [
        'home-only, 45 days to renewal, claims-free → add auto',
        'auto-only, escrow on file → add home',
        'bundled no umbrella, $500k+ exposure → offer $1M',
        'auto + condo, new teen driver → umbrella + telematics',
        'home-only, water backup gap → add endorsement',
        'auto-only, multi-vehicle → add home + key fob benefit',
        'bundled, roof age 16 → replacement schedule check',
        'home+auto, high liability → increase limits + PUP',
        'auto-only, EV → home risk review + equipment breakdown',
        'home-only, mortgage change → add auto now'
      ];
      const list = $('#top-list');
      list.innerHTML = '';
      for (let i = 0; i < topn; i++) {
        const idx = i % reasons.length;
        const li = document.createElement('li');
        li.className = 'plan-item';
        li.innerHTML = `<strong>#${i+1}</strong> — ${reasons[idx]}
          <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap">
            <a class="btn ghost" href="Meeting_Kit_Template.pptx" download>Meeting Kit</a>
            <a class="btn ghost" href="Monthly_Scorecard_Template.pptx" download>Talking Points</a>
          </div>`;
        list.appendChild(li);
      }
    }

    function setConfidence(level = 'estimated') {
      ['tbn','bscore','rl','sti','depth','tenure'].forEach(id => {
        const el = document.getElementById(`conf-${id}`);
        if (el) {
          el.classList.remove('assumed','estimated','measured');
          el.classList.add(level);
          el.textContent = level.charAt(0).toUpperCase() + level.slice(1);
        }
      });
    }

    $$('.scenario .option').forEach(opt => {
      opt.addEventListener('click', () => {
        $$('.scenario .option').forEach(o => o.classList.remove('active'));
        opt.classList.add('active');
        state.scenario = opt.dataset.scenario;
        setConfidence('assumed');
        computeSnapshot();
      });
    });

    document.getElementById('btn-apply').addEventListener('click', () => {
      state.inputs.book = parseInt($('#q-book').value, 10) || 500;
      state.inputs.csr = parseFloat($('#q-csr').value) || 32;
      state.inputs.br = parseFloat($('#q-br').value);
      state.inputs.rl = parseInt($('#q-rl').value, 10) || 19;
      state.inputs.aht = parseFloat($('#q-aht').value) || 5;
      state.inputs.rm = parseFloat($('#q-rm').value) || 80;
      state.inputs.claims = $('#q-claims').value;
      state.inputs.topn = parseInt($('#q-topn').value, 10) || 12;
      setConfidence('estimated');
      computeSnapshot();
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      state.inputs = { book:500, csr:32, br:0.45, rl:19, aht:5, rm:80, claims:'balanced', topn:12 };
      setConfidence('assumed');
      $('#q-book').value = 500;
      $('#q-csr').value = 32;
      $('#q-br').value = '0.45';
      $('#q-rl').value = 19;
      $('#q-aht').value = 5;
      $('#q-rm').value = 80;
      $('#q-claims').value = 'balanced';
      $('#q-topn').value = 12;
      computeSnapshot();
    });

    computeSnapshot();
  })();
  </script>
</body>
</html>


